# 技術スタック比較検討メモ

## 検討の背景

Next.js/Supabaseで開発された「ドラマバカ」の今後の運用方針を検討するにあたり、以下の3つの技術スタック案を比較した。
最優先事項は「コストの安さ/安定性」。また、副次的な判断軸として「AI(Gemini CLI)との連携のしやすさ」も考慮に入れた。

---

## 比較表

| 選択肢 | 主な技術 | コスト/安定性 | AI連携 (私の役割) | メリット / デメリット |
| :--- | :--- | :--- | :--- | :--- |
| **案1: Vercel/Supabase案** | Next.js, Supabase, Vercel | ・**△ 高コスト**<br>・Vercel: $20/user/月<br>・Supabase: $25/project/月 | ・**△ 限定的**<br>・各サービスのWeb UIが基本<br>・API経由の操作は可能だが限定的 | **[メリット]**<br>・最高の開発体験<br>・デプロイが非常に簡単<br><br>**[デメリット]**<br>・複数サイト運営でコスト増<br>・プラットフォームへの依存 | 
| **案2: VPS案** | Next.js, PostgreSQL, VPS | ・**○ 安価**<br>・月額$5〜$15程度<br>・安定性は自己責任 | ・**◎ フルアクセス**<br>・SSH経由で全作業を代行可能<br>・DB操作もコマンドラインで実行 | **[メリット]**<br>・Next.jsの知見を活かせる<br>・AIとの連携が最もスムーズ<br>・自由度が高い<br><br>**[デメリット]**<br>・インフラ管理の手間がかかる | 
| **案3: レンタルサーバー案** | PHP, MySQL, レンタルサーバー | ・**◎ 非常に安価で安定的**<br>・管理不要<br>・今回は既存契約あり(〜9/30) | ・**△ 限定的**<br>・SSHは可能だが、DB操作はphpMyAdmin等が主になる可能性 | **[メリット]**<br>・圧倒的なコスト安定性<br>・情報が豊富<br><br>**[デメリット]**<br>・開発体験がレガシーに感じる可能性<br>・AI連携の自由度が低い | 

---
 ---

  Vercel (Pro Plan)

   * 料金: $20 /ユーザー/月 + 従量課金
   * プロジェクト数:
     制限についての明確な記述はありませんが、料金はあくまで「ユーザー単位」です。つまり、あなた
     が一人で管理する限り、プロジェクトを複数作っても基本料金の$20は変わりません。
   * 主な制限（プランに含まれる量）:
       * 帯域幅: 1TB/月
       * Functions (実行時間): 1,000 GB-hours/月
       * その他、多くの項目でFreeプランの10倍の枠が提供されます。
   * ポイント:
       * 課金は ユーザー単位。
       * 個人で複数の小〜中規模サイトを運営する場合、コストパフォーマンスは悪くないかもしれませ
         ん。ただし、各プロジェクトの合計使用量がプランの上限を超えると従量課金が発生します。

  ---

  Supabase (Pro Plan)

   * 料金: $25 /プロジェクト/月 + 従量課金
   * プロジェクト数: 料金は「プロジェクト単位」です。サイト（プロジェクト）を1つ追加するごとに
     、月額$25が追加でかかります。
   * 主な制限（プランに含まれる量）:
       * DBサイズ: 8GB
       * ストレージ: 100GB
       * 帯域幅: 50GB
       * 月間アクティブユーザー: 100,000人
   * ポイント:
       * 課金は プロジェクト単位。
       * 複数サイトを運営する場合、コストが直接的に増加します。
       * Freeプランと違い、長期間操作しなくてもプロジェクトは停止（凍結）されません。

  結論と次の問い

  この情報から、「複数サイト運営」を視野に入れる場合、Supabaseのコストが大きな課題になること
  が明確になりました。
  例えば、3つのサイトを運営すると、Supabaseだけで $25 * 3 = $75/月
  かかる計算になります（Vercelは$20のまま）。

## 結論

- **論理的な最適解:** 長期的な自由度とAI連携の観点では「**案2: VPS案**」がベストプラクティス。
- **当面の現実解:** 2025/9/30まで有効なXserver契約があるため、その資産を最大限活用し、学習と知見を得る目的で、まずは「**案3: レンタルサーバー案**」から着手する。

---

## 将来的なリポジトリ戦略の検討 (PHP版 → VPS版移行時)

### 選択肢A: 新規リポジトリを作成する (`drabaka-vps` など)

*   **メリット:**
    *   **クリーンな歴史:** VPS版のGit履歴がゼロから始まるため、非常にクリーン。
    *   **依存関係の完全分離:** `composer.json` (PHP) と `package.json` (Node.js) が混在しない。
    *   **明確な区切り:** プロジェクトの世代交代が物理的にも明確になる。
*   **デメリット:**
    *   **ドキュメントの移行:** `docs` フォルダなどを再度コピーする必要がある。
    *   **経緯の分断:** なぜこの設計になったか、という経緯がリポジトリを横断しないと追えなくなる可能性がある。

### 選択肢B: 現行リポジトリを流用する (`draba`)

*   **メリット:**
    *   **歴史の継続性:** PHP版からVPS版への変遷が、一つのGit履歴として残る。
    *   **ドキュメントの共有:** `docs` フォルダはそのまま使える。
*   **デメリット:**
    *   **複雑なGit履歴:** PHPのコードを全て削除し、Next.jsのコードを追加する、という大きなコミットが発生し、履歴が複雑になる。
    *   **不要ファイルの混在:** `composer.json` のようなPHP時代のファイルが履歴に残り続ける。
    *   **設定の切り替えコスト:** Dockerの設定などを大幅に書き換える必要がある。

### 推奨

現時点では、技術スタックが完全に切り替わる「別物への生まれ変わり」であるため、**選択肢A: 新規リポジトリを作成する**方法を推奨する。これにより、各時代のプロジェクトがクリーンな状態で保存され、将来の混乱を防ぐことができる。
最終的な判断は、移行が現実的になった時点で行う。
